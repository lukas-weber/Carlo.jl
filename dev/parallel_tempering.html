<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Parallel tempering · Carlo.jl</title><meta name="title" content="Parallel tempering · Carlo.jl"/><meta property="og:title" content="Parallel tempering · Carlo.jl"/><meta property="twitter:title" content="Parallel tempering · Carlo.jl"/><meta name="description" content="Documentation for Carlo.jl."/><meta property="og:description" content="Documentation for Carlo.jl."/><meta property="twitter:description" content="Documentation for Carlo.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.svg" alt="Carlo.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Carlo.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Carlo.jl</a></li><li><a class="tocitem" href="abstract_mc.html">Implementing your algorithm</a></li><li><span class="tocitem">Advanced Topics</span><ul><li><a class="tocitem" href="evaluables.html">Evaluables</a></li><li><a class="tocitem" href="jobtools.html">JobTools</a></li><li><a class="tocitem" href="resulttools.html">ResultTools</a></li><li><a class="tocitem" href="rng.html">Random Number Generators</a></li><li><a class="tocitem" href="parallel_run_mode.html">Parallel run mode</a></li></ul></li><li><span class="tocitem">Extras</span><ul><li class="is-active"><a class="tocitem" href="parallel_tempering.html">Parallel tempering</a><ul class="internal"><li><a class="tocitem" href="#Configuration"><span>Configuration</span></a></li><li><a class="tocitem" href="#Results"><span>Results</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Extras</a></li><li class="is-active"><a href="parallel_tempering.html">Parallel tempering</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="parallel_tempering.html">Parallel tempering</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/lukas-weber/Carlo.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/lukas-weber/Carlo.jl/blob/main/docs/src/parallel_tempering.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="parallel_tempering"><a class="docs-heading-anchor" href="#parallel_tempering">Parallel tempering</a><a id="parallel_tempering-1"></a><a class="docs-heading-anchor-permalink" href="#parallel_tempering" title="Permalink"></a></h1><p><a href="https://en.wikipedia.org/wiki/Parallel_tempering">Parallel tempering</a> is a method to improve the statistics and ergodicity of a Markov-chain Monte Carlo simulation by running multiple copies with different parameters in parallel and allowing updates that exchange Monte Carlo configurations between the different parameters. A classical example would be to simulate a glassy model at different temperatures so that decorrelated high-temperature configurations continuously enter the low-temperature region and sample the glassy configuration space efficiently.</p><p>Carlo.jl provides an implementation of parallel tempering through a “meta” implementation of the <code>AbstractMC</code> interface, <code>ParallelTemperingMC</code>. It is a Monte Carlo algorithm that can run any other <code>AbstractMC</code> implementation with parallel tempering.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Carlo.ParallelTemperingMC" href="#Carlo.ParallelTemperingMC"><code>Carlo.ParallelTemperingMC</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ParallelTemperingMC &lt;: AbstractMC</code></pre><p>An implementation of the <a href="parallel_run_mode.html#parallel_run_mode">parallel run mode</a> <code>AbstractMC</code> interface that runs other <code>AbstractMC</code> implementations with parallel tempering.</p><p>The child implementation is expected to implement</p><ul><li><a href="parallel_tempering.html#Carlo.parallel_tempering_log_weight_ratio"><code>parallel_tempering_log_weight_ratio</code></a></li><li><a href="parallel_tempering.html#Carlo.parallel_tempering_change_parameter!"><code>parallel_tempering_change_parameter!</code></a></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/lukas-weber/Carlo.jl/blob/57a14573bb4188c2d8ced15b061b93e86f5e4ad4/src/parallel_tempering.jl#L105-L114">source</a></section></article><p>In order to work with parallel tempering, the child algorithm only has to implement the following two methods.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Carlo.parallel_tempering_log_weight_ratio" href="#Carlo.parallel_tempering_log_weight_ratio"><code>Carlo.parallel_tempering_log_weight_ratio</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Carlo.parallel_tempering_log_weight_ratio(mc::YourMC, parameter_name::Symbol, new_value)</code></pre><p>Let <span>$W(x, p)$</span> be the the weight of the Monte Carlo configuration <span>$x$</span> at the current value of the parameter <span>$p$</span> (specified by <code>parameter_name</code>), and <span>$W(x,p&#39;)$</span> be the weight after the parameter has been changed to <code>new_value</code>.</p><p>This function then returns <span>$\log W(x,p&#39;)/W(x,p)$</span>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/lukas-weber/Carlo.jl/blob/57a14573bb4188c2d8ced15b061b93e86f5e4ad4/src/parallel_tempering.jl#L134-L140">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Carlo.parallel_tempering_change_parameter!" href="#Carlo.parallel_tempering_change_parameter!"><code>Carlo.parallel_tempering_change_parameter!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Carlo.parallel_tempering_change_parameter!(mc::YourMC, parameter_name::Symbol, new_value)</code></pre><p>During a parallel tempering simulation, changes the parameter named <code>parameter_name</code> to <code>new_value</code> and performs all necessary updates to the internal structure of <code>YourMC</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/lukas-weber/Carlo.jl/blob/57a14573bb4188c2d8ced15b061b93e86f5e4ad4/src/parallel_tempering.jl#L127-L131">source</a></section></article><p>The algorithm works by orchestrating a number of Monte Carlo processes along a chain of parameter values. Alternatingly, all adjacent even and odd pairs compare their configuration weights and propose a switch of their configurations. If the switch is accepted, the Monte Carlo processes exchange their positions on the chain.</p><h2 id="Configuration"><a class="docs-heading-anchor" href="#Configuration">Configuration</a><a id="Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration" title="Permalink"></a></h2><p>When running a simulation, <code>ParallelTemperingMC</code> is configured through the <code>parallel_tempering</code> task parameter</p><pre><code class="language-julia hljs">using Carlo
using Carlo.JobTools

num_steps = 10

tm = TaskMaker()

tm.parallel_tempering = (
    mc = YourMC,
    parameter = :T,
    values = range(1, 2, num_steps),
    interval = 20,
)

tm.sweeps = 10000
tm.thermalization = 1000
tm.binsize = 100
# [set other parameters here]

task(tm)

job = JobInfo(
    &quot;my_job&quot;,
    ParallelTemperingMC;
    checkpoint_time = &quot;45:00&quot;,
    run_time = &quot;24:00:00&quot;,
    tasks = make_tasks(tm),
    ranks_per_run = num_steps,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">JobInfo(&quot;my_job&quot;, &quot;my_job.data&quot;, ParallelTemperingMC, Random.Xoshiro, TaskInfo[TaskInfo(&quot;task0001&quot;, Dict{Symbol, Any}(:thermalization =&gt; 1000, :binsize =&gt; 100, :sweeps =&gt; 10000, :parallel_tempering =&gt; (mc = Main.YourMC, parameter = :T, values = 1.0:0.1111111111111111:2.0, interval = 20)))], Dates.Second(2700), Dates.Second(86400), 10)</code></pre><p>Here, <code>mc</code> is the type of the child Monte Carlo algorithm that should be run with parallel tempering. <code>parameter</code> is the name of the parameter that should be exchanged in the parallel tempering and <code>values</code> is a chain of values along which exchanges take place. Care should be taken that the probability distributions for adjacent values have some overlap. <code>interval</code> sets the number of Monte Carlo sweeps between a tempering update. A single task set up like that will simulate the entire chain of parameter values at once. It is also possible to simulate multiple independent chains by creating multiple tasks.</p><p>In <code>JobInfo</code> your Monte Carlo type is then replaced by <code>ParallelTemperingMC</code>. Under the hood, <code>ParallelTemperingMC</code> runs in <a href="parallel_run_mode.html#parallel_run_mode">parallel run mode</a> and <code>ranks_per_run</code> has to be set to the number of parameters in the tempering chain. The simulation then has to be run with MPI and the appropriate number of ranks, <code>n * ranks_per_run + 1</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>At the moment, the child Monte Carlo algorithm can only run in single run mode. However, lifting this limitation should not be too hard. If you intend to run parallel tempering on a parallel run mode code, open an issue on GitHub.</p></div></div><h2 id="Results"><a class="docs-heading-anchor" href="#Results">Results</a><a id="Results-1"></a><a class="docs-heading-anchor-permalink" href="#Results" title="Permalink"></a></h2><p>Each observable and evaluable that is calculated by the child code is stacked into a vector where each entry corresponds to a parameter value in the parallel tempering chain. For example, if the child code in the above example calculates the energy, the output for it will be a vector with <code>num_steps</code> values corresponding to the different temperatures in <code>tm.parallel_tempering.values</code>. Observables which are already vectors or higher order arrays in the child code will gain a new last dimension which corresponds to the parallel tempering parameter.</p><p>Additionally, the observable <code>ParallelTemperingPermutation</code> records the permutation of configurations on the parallel tempering chain. This can be used to gauge the ergodicity of the parallel tempering updates.</p><p>Another self-contained example of parallel tempering is contained in the <a href="https://github.com/lukas-weber/Ising.jl"><code>Ising</code></a> reference implementation.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="parallel_run_mode.html">« Parallel run mode</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Thursday 17 April 2025 18:46">Thursday 17 April 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
